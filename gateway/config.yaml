# Gateway Configuration
server:
  http:
    host: "0.0.0.0"
    port: "8080"
    read_timeout: "30s"
    write_timeout: "30s"
    idle_timeout: "60s"
    bounds:
      max_batch: 1000
      max_message_bytes: 65536
    pipeline:
      enqueue_timeout: "5s"
  
  grpc:
    host: "0.0.0.0"
    port: "9090"
    max_batch: 1000
    max_concurrent_streams: 100
    max_connection_idle: "30s"
    max_connection_age: "60s"
    max_connection_age_grace: "10s"
    time: "5s"
    timeout: "1s"

otlp:
  max_log_size: 1048576      # 1MB
  max_message_bytes: 1048576 # 1MB max message size
  max_batch_size: 1000       # 1000 logs per batch
  max_labels: 100            # 100 labels per log
  max_fields: 200            # 200 fields per log
  request_timeout: "30s"     # 30s timeout
  validate_utf8: true        # Validate UTF-8
  allowed_schemas: ["JSON", "LOGFMT", "TEXT"]

emitter:
  output_type: "stdout"      # stdout, kafka, grpc
  batch_size: 100            # Batch size for output
  flush_interval: 5          # Flush interval in seconds

miner:
  addr: "dns:///miner:9000"    # Miner gRPC endpoint
  timeout: "200ms"             # Request timeout
  max_batch: 500               # Max batch size
  max_batch_wait: "25ms"       # Max batch wait time
  max_retries: 2               # Retry attempts
  retry_base_delay: "20ms"     # Base delay between retries
  shadow_only: true            # Shadow mode - don't drop logs yet

sampler:
  addr: "dns:///sampler:9000"  # Sampler gRPC endpoint
  timeout: "100ms"             # Request timeout
  max_batch: 1000              # Max batch size
  max_batch_wait: "25ms"       # Max batch wait time

enforcement:
  debug: true                  # Enforce debug logs
  info: false                  # Enforce info logs
  warn: false                  # Enforce warn logs
  error: false                 # Enforce error logs
  by_namespace:                # Per-namespace overrides
    staging: true

# Loki sink configuration
loki:
  addr: "http://loki:3100"
  flush_interval: "400ms"
  max_batch_bytes: 1000000      # 1MB
  max_batch_entries: 5000
  max_buffer_bytes: 268435456   # 256MB
  max_buffer_entries: 1000000
  request_timeout: "5s"
  mock_mode: false              # Set to true for local development (outputs to stdout)
  retry:
    enabled: true
    initial_backoff: "200ms"
    max_backoff: "5s"
  drop_policy:
    debug_first: true
    protect_info: true
  labels:
    static:
      gateway: "true"

# IndexFeed service configuration
indexfeed:
  addr: "dns:///indexfeed:9000"    # gRPC endpoint
  timeout: "200ms"                 # Request timeout
  max_retries: 2                   # Retry attempts
  retry_base_delay: "20ms"         # Base delay between retries

metrics: {}